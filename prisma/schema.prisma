generator client {
    provider = "prisma-client"
    output   = "../generated/prisma"
}

datasource db {
    provider = "postgresql"
}

//* Enum - BookingStatus
enum BookingStatus {
    CONFIRMED
    COMPLETED
    CANCELLED
}

//* Model - Tutor Profile
model TutorProfile {
    id          String  @id @default(cuid())
    userId      String  @unique
    designation String? @db.VarChar(60)
    bio         String? @db.VarChar(250)

    createdAt DateTime @default(now()) @db.Timestamptz
    updatedAt DateTime @updatedAt @db.Timestamptz

    tutorCategories TutorCategory[]
    reviews         Review[]
    bookings        Booking[]

    @@index([userId])
    @@map("tutor_profile")
}

//* Model - Category
model Category {
    id          String  @id @default(cuid())
    name        String  @unique @db.VarChar(30)
    slug        String  @unique @db.VarChar(30)
    description String? @db.VarChar(100)

    createdAt DateTime @default(now()) @db.Timestamptz
    updatedAt DateTime @updatedAt @db.Timestamptz

    tutorCategories TutorCategory[]

    @@map("category")
}

//* Junction Model - Tutor Category
model TutorCategory {
    tutorId    String
    categoryId String

    tutor    TutorProfile @relation(fields: [tutorId], references: [id], onDelete: Cascade)
    category Category     @relation(fields: [categoryId], references: [id], onDelete: Cascade)

    @@id([tutorId, categoryId])
}

//* Model - Review
model Review {
    id        String  @id @default(cuid())
    studentId String
    tutorId   String
    rating    Decimal @db.Decimal(1, 0)
    feedback  String  @db.VarChar(200)

    createdAt DateTime @default(now()) @db.Timestamptz

    tutor TutorProfile @relation(fields: [tutorId], references: [id], onDelete: Cascade)

    @@index([studentId])
    @@index([tutorId])
}

//* Model - Booking
model Booking {
    id        String        @id @default(cuid())
    studentId String
    tutorId   String
    topic     String        @db.VarChar(100)
    dueTime   DateTime      @db.Timestamptz
    duration  Int           @db.SmallInt
    notes     String?       @db.VarChar(200)
    status    BookingStatus @default(CONFIRMED)

    createdAt DateTime @default(now()) @db.Timestamptz

    tutor TutorProfile @relation(fields: [tutorId], references: [id], onDelete: Cascade)

    @@index([studentId])
    @@index([tutorId])
}
